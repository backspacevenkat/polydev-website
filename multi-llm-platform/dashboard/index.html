<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-LLM Platform Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-50">
    <div id="app">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <h1 class="text-xl font-bold text-gray-900">🤖 Multi-LLM Platform <span class="text-sm font-normal text-blue-600">(OpenRouter-Powered)</span></h1>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-500">{{ userConfig.tier.toUpperCase() }} Plan</span>
                        <span class="text-sm text-gray-500">{{ userConfig.current_usage }}/{{ userConfig.monthly_limit }} queries</span>
                        <div class="w-24 bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" :style="{width: usagePercentage + '%'}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto py-6 px-4">
            <!-- Tabs -->
            <div class="mb-6">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8">
                        <button @click="activeTab = 'dashboard'" 
                                :class="activeTab === 'dashboard' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                            Dashboard
                        </button>
                        <button @click="activeTab = 'models'" 
                                :class="activeTab === 'models' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                            Model Configuration
                        </button>
                        <button @click="activeTab = 'analytics'" 
                                :class="activeTab === 'analytics' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                            Analytics
                        </button>
                        <button @click="activeTab = 'settings'" 
                                :class="activeTab === 'settings' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                            Settings
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div v-if="activeTab === 'dashboard'" class="space-y-6">
                <!-- Usage Overview -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="text-2xl">📊</div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Total Queries</dt>
                                        <dd class="text-lg font-medium text-gray-900">{{ analytics.total_queries || 0 }}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="text-2xl">⚡</div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Avg Response Time</dt>
                                        <dd class="text-lg font-medium text-gray-900">{{ (analytics.avg_processing_time || 0).toFixed(2) }}s</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="text-2xl">🎯</div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Total Tokens</dt>
                                        <dd class="text-lg font-medium text-gray-900">{{ (analytics.total_tokens || 0).toLocaleString() }}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="text-2xl">📈</div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">This Month</dt>
                                        <dd class="text-lg font-medium text-gray-900">{{ userConfig.current_usage || 0 }}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Test Panel -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Quick Test</h3>
                        <div class="mt-2 max-w-xl text-sm text-gray-500">
                            <p>Test your Multi-LLM Platform connection with a simple query.</p>
                        </div>
                        <div class="mt-5">
                            <div class="flex space-x-3">
                                <div class="flex-1">
                                    <textarea v-model="testQuery" 
                                            rows="3" 
                                            class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"
                                            placeholder="Enter a test query..."></textarea>
                                </div>
                                <div>
                                    <button @click="executeTestQuery" 
                                            :disabled="!testQuery || testLoading"
                                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50">
                                        <span v-if="testLoading">Testing...</span>
                                        <span v-else>Test</span>
                                    </button>
                                </div>
                            </div>
                            <div v-if="testResponse" class="mt-4">
                                <div class="bg-gray-50 rounded-md p-4">
                                    <div class="text-sm text-gray-600 mb-2">{{ testResponse.model_used }} • {{ testResponse.tokens_used }} tokens • {{ testResponse.processing_time }}s</div>
                                    <div class="text-sm text-gray-900 whitespace-pre-wrap">{{ testResponse.response }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Configuration Tab -->
            <div v-if="activeTab === 'models'" class="space-y-6">
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">LLM Provider Configuration</h3>
                        <div class="mt-6 space-y-6">
                            
                            <!-- ChatGPT/Codex CLI -->
                            <div class="border rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-md font-medium text-gray-900">ChatGPT (via Codex CLI)</h4>
                                        <p class="text-sm text-gray-500">Uses your existing ChatGPT subscription</p>
                                    </div>
                                    <div class="flex items-center">
                                        <span v-if="userConfig.cli_configs && userConfig.cli_configs.codex" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            ✅ Configured
                                        </span>
                                        <span v-else class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                            ❌ Not Available
                                        </span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" v-model="userConfig.cli_configs.codex" @change="updateConfig" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                        <span class="ml-2 text-sm text-gray-600">Enable Codex CLI integration</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Claude CLI -->
                            <div class="border rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-md font-medium text-gray-900">Claude (via Claude Code CLI)</h4>
                                        <p class="text-sm text-gray-500">Uses your existing Claude subscription</p>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                            🚧 Coming Soon
                                        </span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" disabled class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                        <span class="ml-2 text-sm text-gray-400">Enable Claude Code CLI integration</span>
                                    </label>
                                </div>
                            </div>

                            <!-- API Keys -->
                            <div class="border rounded-lg p-4">
                                <h4 class="text-md font-medium text-gray-900 mb-4">API Key Configuration</h4>
                                
                                <!-- Primary OpenRouter Key -->
                                <div class="mb-6 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                    <h5 class="text-sm font-semibold text-blue-900 mb-2">🌟 Primary API Key (Required for 2025 Models)</h5>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">OpenRouter API Key</label>
                                        <input type="password" v-model="apiKeys.openrouter" @change="updateApiKeys"
                                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                                               placeholder="sk-or-...">
                                        <p class="mt-1 text-xs text-blue-600">🚀 <strong>Get your OpenRouter API key at <a href="https://openrouter.ai" target="_blank" class="underline">https://openrouter.ai</a></strong></p>
                                        <p class="mt-1 text-xs text-blue-600">✅ Required for: GPT-5, Claude 4.1 Opus, Gemini 2.5 Pro, and all 2025 models</p>
                                        <p class="mt-1 text-xs text-blue-600">💰 Includes 10% platform markup + unified billing</p>
                                    </div>
                                </div>
                                
                                <h5 class="text-sm font-medium text-gray-500 mb-4">Legacy API Keys (Optional Fallbacks)</h5>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">OpenAI API Key</label>
                                        <input type="password" v-model="apiKeys.openai" @change="updateApiKeys"
                                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                                               placeholder="sk-...">
                                        <p class="mt-1 text-xs text-gray-500">Legacy fallback - prefer OpenRouter for consistent access</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Anthropic API Key</label>
                                        <input type="password" v-model="apiKeys.anthropic" @change="updateApiKeys"
                                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                                               placeholder="sk-ant-...">
                                        <p class="mt-1 text-xs text-gray-500">Legacy fallback - prefer OpenRouter for Claude 4.1 Opus</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Google AI API Key</label>
                                        <input type="password" v-model="apiKeys.google" @change="updateApiKeys"
                                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                                               placeholder="AI...">
                                        <p class="mt-1 text-xs text-gray-500">Legacy fallback - prefer OpenRouter for Gemini 2.5 Pro</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div v-if="activeTab === 'analytics'" class="space-y-6">
                <!-- Model Usage Chart -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Model Usage Distribution</h3>
                        <div class="mt-6">
                            <div v-for="(count, model) in analytics.model_usage" :key="model" class="flex items-center justify-between py-2">
                                <div class="flex items-center">
                                    <div class="w-4 h-4 rounded-full mr-3" :class="getModelColor(model)"></div>
                                    <span class="text-sm font-medium text-gray-900">{{ model }}</span>
                                </div>
                                <span class="text-sm text-gray-500">{{ count }} queries</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Queries -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Recent Queries</h3>
                        <div class="mt-6">
                            <div class="space-y-4">
                                <div v-for="query in analytics.recent_queries" :key="query.timestamp" class="border-l-4 border-blue-500 pl-4">
                                    <div class="text-sm text-gray-600">{{ formatTimestamp(query.timestamp) }} • {{ query.model_used }} • {{ query.tokens_used }} tokens</div>
                                    <div class="text-sm text-gray-900 mt-1">{{ query.query }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div v-if="activeTab === 'settings'" class="space-y-6">
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Platform Settings</h3>
                        <div class="mt-6 space-y-6">
                            
                            <!-- User Token -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Your Platform Token</label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="text" :value="userToken" readonly
                                           class="flex-1 block w-full rounded-l-md border-gray-300 bg-gray-50 sm:text-sm">
                                    <button @click="copyToken"
                                            class="inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-500 text-sm">
                                        Copy
                                    </button>
                                </div>
                                <p class="mt-2 text-sm text-gray-500">Use this token in your MCP client configuration.</p>
                            </div>

                            <!-- MCP Configuration -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700">MCP Client Configuration</label>
                                <div class="mt-2">
                                    <pre class="bg-gray-800 text-green-400 p-4 rounded-md text-sm overflow-x-auto"><code>{
  "multi-llm-platform": {
    "command": "python3",
    "args": ["/path/to/thin_client.py"],
    "env": {
      "PLATFORM_TOKEN": "{{ userToken }}",
      "PLATFORM_URL": "http://localhost:8000"
    }
  }
}</code></pre>
                                </div>
                            </div>

                            <!-- Subscription Info -->
                            <div class="border-t pt-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-md font-medium text-gray-900">Current Plan: {{ userConfig.tier.toUpperCase() }}</h4>
                                        <p class="text-sm text-gray-500">{{ userConfig.monthly_limit }} queries per month</p>
                                    </div>
                                    <button v-if="userConfig.tier === 'free'" 
                                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
                                        Upgrade to Pro
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    activeTab: 'dashboard',
                    userConfig: {
                        tier: 'free',
                        monthly_limit: 50,
                        current_usage: 0,
                        cli_configs: { codex: true }
                    },
                    analytics: {
                        total_queries: 0,
                        total_tokens: 0,
                        avg_processing_time: 0,
                        model_usage: {},
                        recent_queries: []
                    },
                    apiKeys: {
                        openrouter: '',  // Primary API key for 2025 models
                        openai: '',      // Legacy fallback
                        anthropic: '',   // Legacy fallback
                        google: ''       // Legacy fallback
                    },
                    testQuery: '',
                    testResponse: null,
                    testLoading: false,
                    userToken: 'demo-user-token-12345'
                }
            },
            computed: {
                usagePercentage() {
                    return Math.min((this.userConfig.current_usage / this.userConfig.monthly_limit) * 100, 100);
                }
            },
            methods: {
                async loadUserConfig() {
                    try {
                        const response = await axios.get('/api/user/config', {
                            headers: { 'Authorization': `Bearer ${this.userToken}` }
                        });
                        this.userConfig = response.data;
                    } catch (error) {
                        console.error('Failed to load user config:', error);
                    }
                },
                
                async loadAnalytics() {
                    try {
                        const response = await axios.get('/api/analytics', {
                            headers: { 'Authorization': `Bearer ${this.userToken}` }
                        });
                        this.analytics = response.data;
                    } catch (error) {
                        console.error('Failed to load analytics:', error);
                    }
                },
                
                async updateConfig() {
                    try {
                        await axios.post('/api/user/config', {
                            cli_configs: this.userConfig.cli_configs
                        }, {
                            headers: { 'Authorization': `Bearer ${this.userToken}` }
                        });
                    } catch (error) {
                        console.error('Failed to update config:', error);
                    }
                },
                
                async updateApiKeys() {
                    try {
                        await axios.post('/api/user/config', {
                            api_keys: this.apiKeys
                        }, {
                            headers: { 'Authorization': `Bearer ${this.userToken}` }
                        });
                    } catch (error) {
                        console.error('Failed to update API keys:', error);
                    }
                },
                
                async executeTestQuery() {
                    if (!this.testQuery) return;
                    
                    this.testLoading = true;
                    this.testResponse = null;
                    
                    try {
                        const response = await axios.post('/api/query', {
                            message: this.testQuery,
                            priority: 'normal'
                        }, {
                            headers: { 'Authorization': `Bearer ${this.userToken}` }
                        });
                        this.testResponse = response.data;
                        
                        // Reload analytics and config
                        await this.loadAnalytics();
                        await this.loadUserConfig();
                        
                    } catch (error) {
                        console.error('Query failed:', error);
                        alert('Query failed: ' + (error.response?.data?.detail || error.message));
                    } finally {
                        this.testLoading = false;
                    }
                },
                
                copyToken() {
                    navigator.clipboard.writeText(this.userToken);
                    alert('Token copied to clipboard!');
                },
                
                getModelColor(model) {
                    const colors = {
                        'gpt-5': 'bg-blue-500',
                        'claude-sonnet': 'bg-green-500',
                        'gpt-4o': 'bg-purple-500',
                        'gemini-pro': 'bg-yellow-500'
                    };
                    return colors[model] || 'bg-gray-500';
                },
                
                formatTimestamp(timestamp) {
                    return new Date(timestamp).toLocaleString();
                }
            },
            
            async mounted() {
                await this.loadUserConfig();
                await this.loadAnalytics();
            }
        }).mount('#app');
    </script>
</body>
</html>